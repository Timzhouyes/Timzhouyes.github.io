---
layout:     post   				    # 使用的布局（不需要改）
title:      什么是“精确一次”？  		# 标题 
subtitle:   精确一次的简介和实现方式简析       #副标题
date:       2020-07-07		# 时间
author:     Haiming 						# 作者
header-img: img/post-bg-2015.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - Programming
    - Exactly Once	
---

在很多流系统之中，比如 Flink，kafka和其他的等等之中有一个被广泛讨论的特性：**精确一次(Exactly once)**，但是到底什么是“Exactly once"？怎么才算是实现了”exactly once"?下面进行一下浅析。

[参考](https://juejin.im/post/5cf0ebe05188251c064813be)

# 1. 背景

本文分析了流计算系统中常说的"exactly once"特性，主要观点是：**exactly once 并不保证完全一样**。

[参考](https://www.jianshu.com/p/4f81fcd642d7)

> 什么是有界数据集和无界数据集？
>
> 有界数据：在常规处理之中，我们都会从Mysql等之中拿到信息进行处理，那么处理此类数据的时候，特点是数据为静止不动的，**没有进行追加，或者是再处理的时刻不需要考虑追加写入操作**。这种又称为批处理，**batch processing**。
>
> 无界数据：对于某些场景而言，类似Kafka的持续计算等等都是无界数据集。无界数据集在处理的当下要发生持续变更，追加等等。这种又称为**流计算，Stream Processing**。
>
> ![img](../img/2020-07-07-ExactOnce精确一次/7556614-678275f3dfd79980)
>
> 场景比较：无界数据集和有界数据集，很像池塘和大河，在计算池塘之中的数据时候，只需要将池塘之中当前所有的鱼计算一起就可以了。但是无界数据集，就像江河之中的鱼，在奔流到海的过程之中，每时每刻都有鱼流过而进入大海，那么计算鱼的数量就是持续追加的。
>
> 二者的数据集相对而言是一个模糊的概念，将粒度拉细，如果只是一条一条的处理，那么就可以认为是无界的，如果将粒度做粗，在一个时间段之中做一定的数据处理，那么数据又可以认为是有界的。既然二者之间可以互换，那么业界也就开始追寻批流统一的框架。
>
> 可以同时实现批处理和流处理的框架有Apache Spark和Apache Flink。
>
> 1. Apache Spark的流处理场景就是微批场景，也就是会在特定的时间间隔之内发起一起计算，而不是每条都触发计算。
> 2. Apache Flink最终将批处理和流处理混合到同一引擎当中，使用Apache Flink可以同时实现批处理和流处理任务。

那么，流处理在一般情况下可以简单的描述为对**无界数据或者事件**的连续处理。

流处理程序，一般可以被看做是有向图，而且一般都是有向无环图。这种图中，每个边表示数据或者事件流，每个顶点表示运算符，会使用程序之中定义的逻辑处理来处理来自相邻边的数据和事件。

两种特殊的顶点，为source 和 sink。source 读取外部数据/事件到应用程序之中，而sink通常会收集应用程序生成的结果。示例如下：

![img](../img/2020-07-07-ExactOnce精确一次/16b0d1bc03b3b729)

那么相应的， 流处理引擎就要允许用户指定可靠性语义，因为网路或者机器等原因，无法保证每次信息都被准确传递。一般而言，流处理隐情为应用程序提供了三种数据处理语义：至多一次，至少一次和精确一次。

