---
layout:     post   				    # 使用的布局（不需要改）
title:      Apache架构师总结的30条设计原则  		# 标题 
subtitle:   与个人的一些小心得        #副标题
date:       2020-06-09		# 时间
author:     Haiming 						# 作者
header-img: img/post-bg-2015.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - Programming
    - Architect
---

不想当架构师的后端不是好程序员 :)

看到了一篇文章，之中讲述了一个Apache的架构师提出的30条架构原则。看了一下， 发现对于架构设计，特别是分布式的架构设计很有帮助，在这里对于每一条，进行一下自己的梳理，希望可以有所收获。

[转载文章地址](https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247487528&idx=1&sn=d727035461d2750496a9ecb23540d450&chksm=cea25fe3f9d5d6f51db4a232436ee93d3cf86825317a1ef369ca2ce4e7a6a1ee822c1e8b8fbc&scene=90&xtrack=1&subscene=93&clicktime=1590944659&enterid=1590944659&ascene=56&devicetype=android-28&version=27000a55&nettype=WIFI&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&exportkey=AcITlvCt%2FhkntP4IlIr6AEo%3D&pass_ticket=SjwqC7LBLrDHtDBzLs4ffuIX3ro2PGnj9F5FKZYbStQTDXC7qgB4pWD%2BnneXFS1v&wx_header=1)

# 一. 基本原则

## 1. KISS(Keep it simple, stupid)

保持每件事情尽可能的简单，用最简单的解决方案来解决问题。

> 如果能使用简单的方法去解决问题，就不要将方案搞复杂。同样的功能，显然简单的方式更容易维护和重构。不要给团队挖坑谢谢。

## 2. YAGNI(You aren't gonna need it)

不要去搞不必要的东西，需要时候再搞。

> 不知道为啥外国人总喜欢搞这种迷之缩写……但是理论是可以理解的，有些程序员自认为很有用的未来会被产品提出来的功能，实际上可能很久都不会被用到，反而造成了代码方面的冗余。
>
> 有人会觉得冗余怎么了？我多写几行代码，多一些功能，不好么？我自己是这样理解的：
>
> 1. 这种冗余很难有一个“标准”，就比如怎么知道“多几行代码”，“多几个功能”这个的边界呢？开发目前没有需要的功能不是浪费资源吗？
> 2. 对于这些代码，测试要怎么玩？如果不测，那么因为这些多余的代码，程序出现了问题，算谁的责任？如果测了，那就是不止开发的资源被浪费，测试的资源也被浪费了。

## 3. 爬，走，跑

程序的第一步要求是先跑起来，然后再优化使其变得更好，最后继续优化。迭代着做事情。

> 不知道是不是由于本人junior，我一直都是按照这个标准进行软件开发的（写的时候先不想怎么优化哈哈哈。 
>
> 我认为这一点在目前的软件行业是非常需要的：迅速拿出可以跑的初级版本。因为目前的软件开发是以Agile为主流，那么往往每个迭代会新增或者修改一些功能点，从最坏的角度打算，可能这个版本的修改在下个版本就会被PM割掉或者要求修改。而且“小步快跑”本身就是和“一步到位”矛盾的。因此不要妄想一次性直接做到完美。

## 4. 自动化测试

 创建稳定、高质量的产品的唯一方法就是自动化测试。所有的都可以自动化，当你设计时，不妨想想这一点。

> 自动化测试一定是不可缺少的，尤其是当产品已经足够大，代码足够复杂的时候，只靠人力去“回归”是一定不行的。但是是否只有自动化测试就ok呢？显然不是，比如Win10的bug简直像山一样多，就是因为其开除了手动测试团队。

## 5.  时刻要想投入产出比（ROI）

就是划得来不。

> 每次说到这个，我都想起当时问TL的一个问题：为什么我们不也搭一套完整的微服务框架呢？比如dubbo+zookeeper，redis搞个集群啥的。
>
> 人家一句话就给我怼回来了：你维护么？
>
> 哈哈哈

## 6. 了解你的用户

不要花了几个月时间做了一个 devops 用户界面，最后你发现那些人只喜欢命令行。

> 这部分，如果有问题，那么一般是产品的锅。当然，程序员本身如果接触客户的话，更需要去了解自己的用户。没看清题目就答题，是没有好下场的。

## 7. 尽可能的独立去设计和测试一个功能

当你做设计时，应该想想这一条。从长远来看这能给你解决很多问题，否则你的功能只能等待系统其他所有的功能都就绪了才能测试，这显然很不好。有了这个原则， 你的版本将会更加的顺畅。

> 作者是从架构师的角度来考虑，那么一个很依赖于其他模块的功能，本质上就是不好去测试和处理的。
>
> 如果出于代码维护的角度，独立的功能也应该尽量的拆出来，这样的话，在对功能进行修改或者拓展的时候，可以尽量的保证其他代码的功能不受影响，易于维护。

## 8. 不要玩花活

当你做设计时，应该想想这一条。从长远来看这能给你解决很多问题，否则你的功能只能等待系统其他所有的功能都就绪了才能测试，这显然很不好。有了这个原则， 你的版本将会更加的顺畅。

> 个人觉得和原则1相呼应，除非真的为了解决具体的问题，否则不要为了花哨而花哨，为了“高端”而高端

# 二. 功能选择

## 9. 拥抱MVP(Minimal Viable Product，最小可运行版本)

不可能预测到用户将会如何使用我们的产品。所以要拥抱 MVP（Minimal Viable Product），最小可运行版本。这个观点主要思想就是你挑几个很少的使用场景，然后把它搞出来，然后发布上线让用户使用，然后基于体验和用户反馈再决定下一步要做什么。

> 不要闭门造车，不要想着一开始就搞个大新闻。让客户去定夺他们想要什么，而非是我们自己臆想他们的需求

## 10. 尽可能的做较少的功能 / 11. 等到有人提出再说

当有疑问的时候，就不要去做，甚至干掉。很多功能从来不会被使用。最多留个扩展点就够了。

> 可扩展的代码是很好的代码，但是不要一开始就直接搞上去多余的功能。和原则2呼应

## 12. 有勇气和客户说不

这时候你需要找到一个更好的解决方案来去解决。记住亨利福特曾经说过的 ：”如果我问人们他们需要什么，他们会说我需要一匹速度更快的马”。记住：你是那个专家，你要去引导和领导。要去做正确的事情，而不是流行的事情。最终用户会感谢你为他们提供了汽车。

> 不是只满足对方的要求，而是使用自己的专业素养，给对方介绍我们认为更好的方案。当然，最后定夺权还在客户。

# 三、服务端设计和并发

## 13. 要知道一个Server是如何运行

要知道一个 server 是如何运行的，从硬件到操作系统，直到编程语言。优化 IO 调用的数量是你通往最好架构的首选之路。

> 做好架构就要从头知道到尾，这话果真不假。而在网络应用这种架构之中，IO调用的数量的确是系统对外提供服务的瓶颈，究竟如何才能最大化的利用系统的能力，是一个比较难的问题。

## 14.  要了解 Amdhal 同步定律

[Amdahl's_law](https://en.wikipedia.org/wiki/Amdahl's_law)

>  这个定律主要是说并行多任务不可能无穷无尽的提高任务效率，因为总有一些部分是无法并行完成的。

在线程之间共享可变数据会让你的程序变慢。只在必要的时候才去使用并发的数据结构，只在必须使用同步（synchronization）的时候才去使用同步。如果要用锁，也要确保尽可能少的时间去 hold 住锁。如果要在加锁后做一些事情，要确保自己在锁内会做哪些事情。

> 尽量少的使用并发的数据结构，尽量少的使用同步，尽量少的使用加锁时间。 例如Redis就是用单线程来避免了这些无谓的开销。

## 15. 无阻塞且事件驱动

如果你的设计是一个无阻塞且事件驱动的架构，那么千万不要阻塞线程或者在这些线程中做一些 IO 操作，如果你做了，你的系统会慢的像骡子一样。

> 看看，为啥NIO要阻塞线程呢？而且事件驱动，意味着其会接受中断的信号，比如网络IO这种硬中断，那么人家都给你数据搞完了，为啥要自己在线程之中做IO呢？不可理喻。

# 四、分布式系统

