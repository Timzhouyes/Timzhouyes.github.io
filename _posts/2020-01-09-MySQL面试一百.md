---
layout:     post   				    # 使用的布局（不需要改）
title:      MySQL面试相关问题  		# 标题 
subtitle:           #副标题
date:       2020-01-09		# 时间
author:     Haiming 						# 作者
header-img: img/post-bg-2015.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - 编程
    - MySQL
    - 面试
---
对于互联网行业而言，MySQL是非常重要的一环。

除了我们刚刚梳理过的[MySQL之中索引的部分知识](https://timzhouyes.github.io/2020/01/06/MySQL-索引/)之外，还有其他的一些MySQL相关的知识点需要我们去掌握。在之前的一些文章之中有过梳理，在此总结一篇我认为很好的文章，作为一个综合性的整理。

http://huyan.couplecoders.tech/mysql/%E7%AC%94%E8%AF%95%E9%9D%A2%E8%AF%95/2019/07/10/MySQL%E9%9D%A2%E8%AF%95%E4%B8%80%E7%99%BE%E9%97%AE/

# 对于本文之中一些观点的不同理解

首先是对于”事务“的不同理解。我是不推荐在项目之中使用数据库的事务的。

# 索引相关

关于索引的内容在上一篇博文之中已经写过不少了，在这里只是简要的介绍一下。

### 什么是索引？

索引是一种数据结构，将某些数据按照特定顺序进行重新排列，以达到优化查找速度的目的。

### 索引是一个怎样的数据结构？

索引的数据结构和选用的具体存储引擎的实现有关。索引有Hash索引，B+树索引等等，而经常使用的InnoDB实现的索引的数据结构是B+树索引。

### Hash索引和B+树索引有何区别？优劣比较？

Hash索引，其底层就是hash表格，每次操作都是调用hash函数获得其键值，然后回表查询。

而B+树其底层是多路平衡查找树，在查询过程之中，每次都是从根节点直接到最底层的叶子节点，查找叶子节点才可以得到最终所查键值。根据索引之中的键值，来确定其是否需要回表查询数据。（例如上一篇文章之中说的，联合索引在某些情况之下可以直接返回而不需要拿到主键键值再去大表之中查询）

那么可以看出来其不同：

从原理上来讲，hash索引是将数据取Hash值之后作为其主键，然后对其进行各种操作。这就决定了对于Hash索引而言，每一条记录都是单独处理的，彼此之间没有范围或者排序上面的联系。但是B+树在叶子这一层所有的节点都连在一起，且是按照顺序连接，因此其可以处理范围值。B+树的所有节点都遵循左节点小于父节点，右节点大于父节点的的规律。

Hash函数的优势：

- Hash索引进行等值查询更快

B+树的优势：

- B+树支持使用索引进行排序，而Hash索引不支持其使用索引进行排序。
- B+树支持模糊查询和多列查询的最左前缀匹配。但是因为hash函数的不可预测性，这两个特性hash索引都无法支持。因为对于Hash而言，AAAA和AAAAB的hash值是完全没有关系的。
- hash索引在任何时候都不能避免回表查询数据。**Hash索引之中存储的是hash值和值所在的指针。**那么在Hash索引之中就无法存储任何的有用信息。而B+树在符合某些条件的时候，比如上一篇文章之中所说的，其可以在聚簇索引之中直接取得部分值，在某些情况之下不需要再去大表查所有的值。
- hash索引虽然在单个值的查询上面比较快，但是其性能不稳定，不可预测，因为其在某个键值存在冲突的时候，会发生hash碰撞，这个时候的效率比较差。但是B+树的查询比较稳定（其每次都到叶子节点才可以取得主键值，而且本身B+树的高度就比较低）。

综上，在大部分的情况下，选择B+树索引可以获得较好而且比较稳定的查询速度，而不需要使用hash索引。

### 提到了B+树在满足聚簇索引和覆盖索引的时候不需要回表查询数据，那么什么是聚簇索引？

在B+树的索引之中，叶子节点可能存储了当前的key值，或者存储了key值和当前整行的数据，这就是非聚簇索引和聚簇索引。

在InnoDB之中，只有主键索引才是聚簇索引。如果没有主键，那么首选是一个唯一键来做索引，如果所有的列都不是唯一键，那么自己生成一个列作为索引列。

如果查询使用聚簇索引的时候，在对应的叶子节点就可以获取所有的信息，不再需要进行回表查询。

### 非聚簇索引一定会回表查询吗？

不一定。我们从定义上面也可以区分出来，非聚簇索引之中的叶子节点上面有可能包含其所指向列的部分信息，如果我们所要的信息在索引之中已经完全包括了，例如我们已经在员工表的age 上面建立了索引，那么当进行`select age from employee where age<20` 的查询，就可以在叶子节点上面直接拿到age信息，从而不需要进行再次的回表查询。

### 在建立索引的时候，有哪些需要考虑的因素呢？

在建立索引的过程之中，首先要考虑的是字段的使用频率，如果涉及到联合索引，按照我前一篇博文之中提到过的，还需要考虑索引之中的顺序问题。此外就是不要矫枉过正，对使用频率不高的列也进行额外的索引，防止对表造成过高的压力。

### 联合索引是什么？为何要注意联合索引之中的顺序？

MySQL 可以使用多个字段同时建立一个索引，叫做联合索引。在联合索引之中，如果想要命中索引，必须按照建立索引的顺序使用索引，不然就没有办法命中索引。

这个在我们之前的文章之中也有提到过，就是联合索引之中，只有前一列的值相同的情况下，后一列的值才有序，所以没有办法单独使用后一列作为索引。

### 创建的索引有没有被使用到？怎么才能知道为何某条语句运行速度很慢？

MySQL 之中提供了explain命令来查看语句的执行计划。MySQL在执行某条语句之前，会将该语句直接过一遍查询优化器，之后会拿到对该语句的分析，也就是执行计划，其中包含的信息可以用来做进一步的分析。这些信息可以用来分析是否命中了索引，例如`possible_key`，`key`,`key_len`等字段，分别说明了这个语句`可能使用的索引`，`实际使用的索引`和`索引长度`。



