---
layout:     post   				    # 使用的布局（不需要改）
title:      MyInfo 使用方法				# 标题 
subtitle:  对于MyInfo 的 API 调用做一点小结  #副标题
date:       2019-10-22 				# 时间
author:     Haiming 						# 作者
header-img: img/post-bg-2015.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - 编程
    - API
    - MyInfo
---



# MyInfo API Data**

数据分为两种：政府确认数据和用户个人提供数据。

政府确认数据，是从政府的信息源拿到的，不可以以电子形式更改。个人提供数据是User自己在MyInfo APP 之中提供的，可以以电子形式更改。

# **FAQ**

1. MyInfo 不支持IP白名单，但是可以白名单下面的Fully Qualified Domain Names:
   1. test.api.myinfo.gov.sg
   2. api.myinfo.gov.sg
2. API更新会通过邮件发送，但是并没有提及是哪个邮件……
3. MyInfo API 只支持Web-based Integration。 暂时不支持 Native mobile applications
4. 关于X.509 的相关问题：
   1. 在staging 和 production 环境的 key 应该不同
   2. Key 是由可信的CA 发布的
   3. 可以在不同的产品之中使用一样的public key，但是要区分staging 和 production 的环境 
5. 如果架构设计要求获得可信的MyInfo Web SSL certificate， 那么可以从下面的链接拿到：
   1. [version 3 app](https://public.cloud.myinfo.gov.sg/myinfo/certs/myinfo_v3_api_cert_chain.zip)
   2. [version 2 app](https://public.cloud.myinfo.gov.sg/apex/apex_public_certs_v2.zip)
6. 在应用配置（**app configurations submission**）之中，对于Callback URL 的要求：
   1. 在staging 和 product 环境用不同的 callback URL
   2. 使用 static callback URL，动态URL 不支持
   3. 在staging 和 product 环境之中的callback URL之中使用Fully Qualified Domain Names (FQDN) ，不可以使用静态IP地址或者端口号。
7. 有其他问题，support@myinfo.gov.sg

# Get started

作为申请的一部分，要将APP 如何和MyInfo 互相调用的步骤用PDF画出来。模版在附件之中。

# Technical Requirements

### Transcation Log

下面是建议的最小追踪字段：

- NRIC/FIN
- Fields requested from myInfo
- 时间戳

### X.509 Public Key

密钥可以从以下被确认的CA获得：

- digiCert
- Entrust
- Comodo
- VeriSign
- GlobalSign
- GeoTrust

### TLS 和密码套件

MyInfo 支持 TLS 1.1 和更高版本。

下面是支持的密码套件：

- TLS_RSA_WITH_AES_256_GCM_SHA384
- TLS_RSA_WITH_AES_128_GCM_SHA256
- TLS_RSA_WITH_AES_256_CBC_SHA256
- TLS_RSA_WITH_AES_256_CBC_SHA
- TLS_RSA_WITH_AES_128_CBC_SHA256
- TLS_RSA_WITH_AES_128_CBC_SHA

### Callback URLs

除了之前提到过的，为了安全原因应该区分staging 和 production 环境等之外，Callback URLs不应该包含 # 或者 * 符号。

### Toturial

#### Understanding OAuth2.0 flow for MyInfo APIs

全程需要使用三个不同的API。

1. 授权 Authorise

   API 调用的是 SingPass 的验证流程，然后显示“获取用户同意”的页面，在流程结束之后，系统会返回一个存活期很短的“authorisation code"。

   API 是通过浏览器的 302 重定向触发的。

2. 令牌 Token

   应用服务器唤醒 API 来得到 access token，这个 token 被用来调用 personal API 来获取真实数据。应用要提供和一个有效的“authorisation code” 调用 authorise API 去换取 access token。 整个 token 的存活时间是 30 分钟。

   这个API 是server-to-server call，不通过浏览器。

3. 个人 Person

   这个 API 返回一个 JSON ，包含请求的个人数据。应用需要使用一个有效的 “access token” 来得到 JSON 数据。

   这个 API 是一个 server-to-server call。

![MyInfo OAuth 2.0 Sequence Diagram](../img/myinfo-oauth2-sequence.png)